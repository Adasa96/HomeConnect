{% extends 'base.html' %}

{% block title %}Provider Dashboard{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow-sm p-4">
        <h2 class="mb-4">Provider Dashboard</h2>
        <p>Welcome, {{ provider.company_name|default:provider.user.username }}</p>

        <a href="{% url 'accounts:provider_showcase' %}" class="btn btn-info mb-3">Showcase My Skills</a>

        <h3>Incoming Requests</h3>
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Homeowner</th>
                    <th>Service</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for req in requests %}
                <tr>
                    <td>{{ req.id }}</td>
                    <td>{{ req.homeowner.username }}</td>
                    <td>{{ req.service.name }}</td>
                    <td>{{ req.description|truncatechars:50 }}</td>
                    <td>{{ req.get_status_display }}</td>
                    <td>
                        <div class="d-flex gap-1">
                            {% if req.status == 'pending' %}
                            <form method="post" action="{% url 'services:request_action' req.pk %}">
                                {% csrf_token %}
                                <button name="action" value="accept" class="btn btn-sm btn-success">Accept</button>
                                <button name="action" value="cancel" class="btn btn-sm btn-danger">Cancel</button>
                            </form>
                            {% elif req.status == 'accepted' %}
                            <form method="post" action="{% url 'services:request_action' req.pk %}">
                                {% csrf_token %}
                                <button name="action" value="complete" class="btn btn-sm btn-primary">Complete</button>
                            </form>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center">No incoming requests yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
